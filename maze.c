#include <stdio.h> // base do código
#include <time.h>//Necessario para o timer
#include <sys/time.h>//Necessario para o timer
#include <stdlib.h>//Necessário para usar a função System("clear")
#include <termios.h>//Necessário para scanear sem ENTER
#include <string.h> //Necessário para 
#include <unistd.h> // Necessário para usar a função sleep
#include <locale.h> // Necessário para printar os acentos 

#define RESET   "\x1b[0m"     // Resetar formatação (ANSI)
#define RED     "\x1b[41m"    // Fundo vermelho (ANSI)
#define GREEN   "\x1b[42m"    // Fundo verde (ANSI)
#define YELLOW  "\x1b[43m"    // Fundo amarelo (ANSI)
#define BLUE    "\x1b[44m"    // Fundo azul (ANSI)
#define MAGENTA "\x1b[45m"    // Fundo magenta (ANSI)
#define CYAN    "\x1b[46m"    // Fundo ciano (ANSI)
#define WHITE   "\x1b[47m"    // Fundo branco (ANSI)
#define RANKING_FILE "ranking.txt" //txt para o ranking

#define LARGURA 70
#define ALTURA  40

int getch() {
    struct termios oldt, newt;
    int ch;
    tcgetattr(STDIN_FILENO, &oldt);
    newt = oldt;
    newt.c_lflag &= ~(ICANON | ECHO);
    tcsetattr(STDIN_FILENO, TCSANOW, &newt);
    ch = getchar();
    tcsetattr(STDIN_FILENO, TCSANOW, &oldt);
    return ch;
}

typedef struct {
    int x, y;
    char nick[6];
} Posicao;

void start_timer(struct timeval *start_time) { //Captura o tempo inicial.
    gettimeofday(start_time, NULL);
}

void stop_timer(struct timeval *end_time) {//Captura o tempo final.
    gettimeofday(end_time, NULL);
}

double elapsed_time(struct timeval start_time, struct timeval end_time) { //Calcula o tempo decorrido entre o tempo inicial e o tempo final em segundos e microsegundos.
    long seconds = end_time.tv_sec - start_time.tv_sec;
    long useconds = end_time.tv_usec - start_time.tv_usec;
    double elapsed = seconds + useconds / 1000000.0;
    return elapsed;
}

void imprimirLabirinto(char labirinto[ALTURA][LARGURA], Posicao jogador) {
    system("clear"); // Limpar a tela 
    for (int i = 0; i < ALTURA; i++) {
        for (int j = 0; j < LARGURA; j++) {
            if (i == jogador.y && j == jogador.x) {
                printf(GREEN "  " RESET); // Jogador
            } else if (labirinto[i][j] == '#') {
                printf(RED "  " RESET); // Parede
            } else if (labirinto[i][j] == 'E') {
                printf(BLUE "  " RESET); // Saída
            } else if (labirinto[i][j] == 'K') {
                printf(BLUE "  " RESET); // Saída
            } else if (labirinto[i][j] == '-') {
                printf(WHITE "  " RESET); //TEM QUE DEIXAR COMO
            }else {
                printf("  "); // Espaço vazio
            }
        }
        printf("\n");
    }
}

void imprimirMenu(char menu1[ALTURA][LARGURA]) {
    system("clear"); // Limpar a tela (para Windows)
    for (int i = 0; i < ALTURA; i++) {
        for (int j = 0; j < LARGURA; j++) {
            if (menu1[i][j] == '=') {
                printf(BLUE "  " RESET); // Blue for '='
            } else if (menu1[i][j] == '~') {
                printf(RED "  " RESET, menu1[i][j]); // Red for menu text
            } else {
                printf(RED " %c" RESET, menu1[i][j]); // Red for menu text
            } 
        }
        printf("\n");
    }

}

void imprimirInicio(char inicio[ALTURA][LARGURA]) {
    system("clear"); // Limpar a tela (para Windows)
    for (int i = 0; i < ALTURA; i++) {
        for (int j = 0; j < LARGURA; j++) {
            if (inicio[i][j] == '=') {
                printf(BLUE "  " RESET); // Blue for '='
            } else if (inicio[i][j] == '~') {
                printf(RED "  " RESET, inicio[i][j]); // Red for menu text
            } else {
                printf(RED " %c" RESET, inicio[i][j]); // Red for menu text
            } 
        }
        printf("\n");
    }

}

void imprimirInstrucoes(char instrucao[ALTURA][LARGURA]) {
    setlocale(LC_ALL, "pt_BR.UTF-8");
    system("clear"); // Limpar a tela (para Windows)
    for (int i = 0; i < ALTURA; i++) {
        for (int j = 0; j < LARGURA; j++) {
            if (instrucao[i][j] == '=') {
                printf(CYAN "  " RESET); // Fundo azul para '='
            } else if (instrucao[i][j] == '~') {
                printf(MAGENTA "  " RESET); // Fundo magenta para espaços
            }else  {
                printf(MAGENTA " %c" RESET, instrucao[i][j]); // Fundo magenta para espaços
            }
        }
        printf("\n");
    }
    getch();
}

void imprimirAvanco(char Avanco[ALTURA][LARGURA]) {
    system("clear"); // Limpar a tela (para Windows)
    for (int i = 0; i < ALTURA; i++) {
        for (int j = 0; j < LARGURA; j++) {
            if (Avanco[i][j] == '=') {
                printf(CYAN "  " RESET); // Fundo azul para '='
            } else if (Avanco[i][j] == '~') {
                printf(MAGENTA "  " RESET); // Fundo magenta para espaços
            }else  {
                printf(MAGENTA " %c" RESET, Avanco[i][j]); // Fundo magenta para espaços
            }
        }
        printf("\n");
    }
    getch();
}

void imprimirFinal(char fim[ALTURA][LARGURA], double tempo, Posicao Jogador) {
    system("clear"); // Use "clear" para Unix/Linux
    int minutes = (int) tempo / 60;
    int seconds = (int) tempo % 60;
    int k = 0, y = 0;
    char time_str[5];
    sprintf(time_str, "%02d:%02d", minutes, seconds);
    int a = strlen(Jogador.nick);

    for (int i = 0; i < ALTURA; i++) {
        for (int j = 0; j < LARGURA; j++) {
            if (fim[i][j] == '=') {
                printf(GREEN "  " RESET);
            } else if (fim[i][j] == '~') {
                printf(BLUE "  " RESET);
            }  else if (fim[i][j] == '#') {
                printf(BLUE " %c" RESET, time_str[k]);
                k++;
            } else if (fim[i][j] == '*') {
                if (y < a ) {
                    printf(BLUE " %c" RESET, Jogador.nick[y]);
                    y++;
                } else {
                    printf(GREEN "  " RESET); 
                }
            } else if (fim[i][j] == '-') {
                printf(RED "  " RESET); 
            } else {
                printf(BLUE " %c" RESET, fim[i][j]);
            }
        }
        printf("\n");
    }
}


void imprimirSaida(char saida[ALTURA][LARGURA]) {
    system("clear"); // Limpar a tela (para Windows)
    for (int i = 0; i < ALTURA; i++) {
        for (int j = 0; j < LARGURA; j++) {
            if (saida[i][j] == '=') {
                printf(WHITE "  " RESET); // Fundo branco para '='
            } else if (saida[i][j] == '~') {
                printf(BLUE "  " RESET); // Fundo azul para espaços
            }else  {
                printf(BLUE " %c" RESET, saida[i][j]); // Fundo azul para espaços
            }
        }
        printf("\n");
    }
    getch();
}


int main() {

    setlocale(LC_ALL, "Portuguese");


    char inicio[ALTURA][LARGURA]= {
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~======================= Digite seu Nickname =======================~",
        "~==================== Deve possuir 5 Caracteres ====================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
    };

    char menu[ALTURA][LARGURA]= {
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~==============================-MENU-===============================~",
        "~==========================1-INICIAR JOGO===========================~",
        "~===========================2-INSTRUCOES============================~",
        "~==============================3-SAIR===============================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
    };

    char instrucoes[ALTURA][LARGURA] = {
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~========================Instrucoes do Maze=========================~",
        "~===================================================================~",
        "~====1.Use as teclas W,A,S,D para mover o jogador pelo labirinto====~",
        "~===================================================================~",
        "~============2.Tente chegar a saida marcada de cor Azul=============~",
        "~===================================================================~",
        "~===========3.Evite paredes, siga pelos corredores livres===========~",
        "~===================================================================~",
        "~===========Pressione qualquer tecla para voltar ao menu============~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
    };
    char Avancar1[ALTURA][LARGURA] = {
        
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~=============VOCE CHEGOU A SAIDA DO PRIMEIRO LABIRINTO=============~",
        "~===================================================================~",
        "~==================VAMOS PARA O SEGUNDO LABIRINTO!==================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        
    };

    char Avancar2[ALTURA][LARGURA] = {
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~=============VOCE CHEGOU A SAIDA DO SEGUNDO LABIRINTO==============~",
        "~===================================================================~",
        "~=================VAMOS PARA O TERCEIRO LABIRINTO!==================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
    };

    char Avancar3[ALTURA][LARGURA] = {
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~=============VOCE CHEGOU A SAIDA DO TERCEIRO LABIRINTO=============~",
        "~===================================================================~",
        "~==================VAMOS PARA O QUARTO LABIRINTO!===================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
    };
    char Avancar4[ALTURA][LARGURA] = {
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~=============VOCE CHEGOU A SAIDA DO QUARTO LABIRINTO===============~",
        "~===================================================================~",
        "~==================VAMOS PARA O QUINTO LABIRINTO!===================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
    };
    


    char final[ALTURA][LARGURA]= {
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~============================PARABENS=*****=========================~",
        "~===================================================================~",
        "~================O ULTIMO LABIRINTO FOI FINALIZADO==================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===============================TIMER===============================~",
        "~===================================================================~",
        "~==============================-------==============================~",
        "~==============================-#####-==============================~",
        "~==============================-------==============================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
    };

    char saida[ALTURA][LARGURA] = {
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~==================O JOGO ESTA SENDO ENCERRADO :( ==================~",
        "~===================================================================~",
        "~=====================CLIQUE EM QUALQUER TECLA!=====================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
    };

   

    char labirinto1[ALTURA][LARGURA] = {
        "#####################################################################",
        "#P           K  #           #     #      #          #       #      K#",
        "### #####   ### ### ##### ### ### ### ### ##### ##### #####  #### ###",
        "#                 #     #     #   #   #       #       #   #       # #",
        "# ### ####### ### ##### ####### ##### ### ##### ####### ### ### ### #",
        "#     #     #         #               #   #       #       #   #   # #",
        "# ### ### ### ### ##  ### #########  #### ### ### ### ### # ### ### #",
        "# #       #   #   #         #     #     # #     #     # #       # # #",
        "# ### ########### ### ### ### ### ##  ### ### # # ##### # ####  ### #",
        "#     #   #           #   # #   #     #   #     #       #          K#",
        "##### ### ### ##### ### ### ### ##### ### ### ########### ### #######",
        "#     #   #       #     # #   #     #     #           #   #   #     #",
        "### ### ### ##### ### ### ### ### ###  ## ### ####### ### ### ### ###",
        "#   # # #   #   #     #     # # # #     #   #       #     #     #   #",
        "### ### ### ### ##### ##### ### ### #  ## ### ##### ##### ### ##### #",
        "#     #   #     #         #   #     #     #   # #     #   # #     # #",
        "##### ### ##### ##### ### ### ### ###  ###### ### ### ##### ### ### #",
        "#     #       #     # #         #   #     #       #   #   #     #  K#",
        "### ##### ##### ### ### ### ##### ### ##  ##### ##### ### ### ##### #",
        "#       # #   #   # #       #   #     #             #     #       # #",
        "### ### ### ##### ##### ### ### ### ### ##### ###  ## ### ##### ### #",
        "#     #     #   #       #     # #   # # #   # # #   # # #   #   #   #",
        "##### ### ### ### ### ##### ##### ### ### ### ###  #### ### ##### ###",
        "#   #   #   #     # #   #     #     #     #             #       #   #",
        "### ######### ##### ### ##### ### ### ########  ###  #### ### ### ###",
        "#   #     #   # #   # #             # #                     # #     #",
        "# ### ##### ### ### ### ########### ### ### ##### ### ###  ## ##### #",
        "# #   # #       #   #     # #     #     # # #     # # # #  #  #   # #",
        "# ##### ##### ### ### ### ### ### ##### ### ### ### ### #  ###### ###",
        "##   #   #     #     #   #     #   #           # # #         #     ##",
        "# ### ### ##### ### ### ### ##### ######### ### ### ###  #### ### ###",
        "# #       # #     #     #     #       #     #     # #           #   #",
        "### ### ##### ##### ##### ### ### ######### ### ### ### ####  ### ###",
        "#   # #   # #   # #       #   #                # # # #         #    #",
        "##### ### ### ### ### ######### ### ####### ### ### ### ####   ## ###",
        "#   #   # #     #   #       #K    #    #    #   #    #             E#",
        "#####################################################################"
    };
    

      char labirinto2[ALTURA][LARGURA] = {
        "#####################################################################",
        "#P        #     #           #     #       #         #       #       #",
        "### ####### ### ### ##### ### ### ### ### ##### ##### ##### ##### ###",
        "#             #   #     #     #   #   #       #       #   #       # #",
        "# ### ####### ### ##### ####### ##### ### ##### ####### ### ### ### #",
        "#     #     #     #   #     #       #     #       #       #   #   # #",
        "# ### ### ### ### ### ### ### ##### ##### ### ### ### ### ##### ### #",
        "# #       #   #   #   #   # #     #     # #     #     # #       # # #",
        "# ### ########### ### ### ### ### ### ### ### ### ##### # ##### ### #",
        "#     #   #           #   # #   #     #   #     #       #     #     #",
        "##### ### ### ##### ### ### ### ######### ### ########### ### #######",
        "#     #   #       #     # #   #     #     #           #   #   #     #",
        "### ### ### ##### ### ### ### ### ### ### ### ####### ### ### ### ###",
        "#   # # #   #   #     #     # # # #     #   #       #     #     #   #",
        "### ### ### ### ##### ##### ### ### ##### ### ##### ##### ### ##### #",
        "#     #   #     #         #   #     #     #   # #     #   # #     # #",
        "##### ### ##### ##### ### ### ### ### ####### ### ### ##### ### ### #",
        "#     #       #     # #         #   #     #       #   #   #     #   #",
        "### ##### ##### ### ### ### ##### ### ### ##### ##### ### ### ##### #",
        "#       # #   #   # #       #   #     #     #       #     #       # #",
        "### ### ### ##### ##### ### ### ### ### ##### ### ### ### ##### ### #",
        "#     #     #   #       #     # #   # # #   # # #   # # #   #   #   #",
        "##### ### ### ### ### ##### ##### ### ### ### ### ##### ### ##### ###",
        "#   #   #   #     # #   #     #     #     #E      #     #       #   #",
        "### ##### ### ##### ### ##### ### ### ######### ### ##### ### ### ###",
        "#   #     #   # #   # #       #     # #         #     #     # #     #",
        "# ### ##### ### ### ### ##### ### # ### ### ##### ### ### ### ##### #",
        "# #   # #       #   #     # #     #     # # #     # # # # #   #   # #",
        "# ##### ##### ### ### ### ### ### ##### ### ### ### ### ### ##### ###",
        "##   #   #     #     #   #K    #   #     #     # # #   #     #     ##",
        "# ### ### ####  ### ### ### ##### ##### ### ### ### ### ##### ### ###",
        "# #       # #     #     #     #       #     #     # #     #     #   #",
        "### ### ##### ##### ##### ### ### ######### ### ### ### ##### ### ###",
        "#   # #   # #   # #       #   #       #   #     # # # #       # #   #",
        "##### ### ### ### ### ######### ### ### ### ### ### ### ######### ###",
        "#   #   # #    ##   #     K #    ##   #     #                      K#",
        "#####################################################################"
    };

    char labirinto3[ALTURA][LARGURA] = {
        "######################################################################",
        "#P    #  #     # # # #   # #     #       #         #       #         #",
        "### ####### ### ### ##### ### ### ### ### ##### ##### ##### ##### ####",
        "#   #     #   #     # #   #   #   #       #       #   #       #   # ##",
        "# ### ####### ### ##### ####### ##### ### ##### ####### ### ### ### ##",
        "#         # #     #   # #   #       #     #       #       #   #   # ##",
        "# ### ### ### ### ### ### ### ##### ##### ### ### ### ### ##### ### ##",
        "# #           #   #   #   # #     #     # #     #     # #         # ##",
        "# ### ####### ### ### ### ### ### ### ### ### ### ##### # ##### # # ##",
        "#     #   #               # #   #     #   #     #       #     # #   ##",
        "##### ### ### ##### ### ### ### ######### ### ########### ### ########",
        "#     #   #       #     # #   #     #     #               #   #     ##",
        "### ### ### ##### ####### ### ### ### ### ### ####### ### ### ### ####",
        "#   # # #   #   #     #     # # # #     #   #       #     #         ##",
        "### ### ### ### ##### ##### ### ### ##### ### ##### ##### ### ##### ##",
        "#     #   #     #         #   #     #     #   # #     #   # #     # ##",
        "##### ### ##### ##### ### ### ### ### ####### ### ### ##### ### ### ##",
        "#     #       #     # #         #   #     #       #   #   #     # # ##",
        "### ##### ##### ### ### ### ##### ### ### ##### ##### ### ### ##### ##",
        "#       # #   #   # #       #   #     #     #      ##     #       # ##",
        "### ### ### ##### ##### ### ### ### ### ##### ### ### ### ##### ### ##",
        "#     #         #       #     # #   # # #   # # #   # # #   #   #   ##",
        "##### ### ### ### ### ##### ##### ### ### ### ### ##### ### ##### ####",
        "#   #   #   #     # #   #     #     #     #       #     #       #  E##",
        "### ##### ### ##### ### ##### ### ### ######### ### ##### ### ### ####",
        "#   #     #   # #   # #       #     # #         #     #     # #     ##",
        "# ### ##### ### ### ### ##### ### # ### ### ##### ### ### ### ##### ##",
        "# #   # #       #   #     # #     #     # # #     # # # # #   #   # ##",
        "# ##### ##### ### ### ### ### ### ##### ### ### ### ### ### ##### ####",
        "##   #   #     #     #   #     #   #     #     # # #   #     #      ##",
        "# ### ### ### # ### ### ### ##### ##### ### ### ### ### ##### ### ####",
        "# #       # #     #     #     #       #     #     # #     #     #   ##",
        "### ### ##### ##### ##### ### ### ######### ### ### ### ##### ### ####",
        "#   # #   # #   # #       #   #       #   #     # # # #       # #  K##",
        "##### ### ### ### ### ######### ### ### ### ### ### ### ######### ####",
        "#   #   # #      #  #       #  K  #   #     #                       K#",
        "######################################################################"
    };

    char labirinto4[ALTURA][LARGURA] = {
        "######################################################################",
        "#P    #  #     # # # #   # #     #                 #       #        K#",
        "### ####### ### ### ##### ### ### ### ### ##### ##### ##### ##### ####",
        "#   #     #   #     # #   #   #           #       #   #       #   # ##",
        "# ### ####### ### ##### ####### ##### ### ##### ####### ### ### ### ##",
        "#         # #     #   # #   #             #       #       #   #   # ##",
        "# ### ### ### ### ### ### ### ########### ### ### ### ### ##### ### ##",
        "# #           #   #   #   # #     #     # #     #       #         # ##",
        "# ### ####### ### ### ### ### ### ### ### ### ### ##### # #####     ##",
        "#     #   #               # #   #     #   #     #       #     # #  K##",
        "##### ### ### ##### ### ### ### ######### ### ########### ### ########",
        "#     #   #       #     # #   #     #     #           #   #   #     ##",
        "### ### ### ##### ####### ### ### ### ### ### ####### ### ### ### ####",
        "#   # # #   #   #     #     # # #      E#   #       #     #     #   ##",
        "### ### ### ### ##### ##### ### ### ##### ### ##### ##### ### ##### ##",
        "#     #   #     #         #   #  #  #     #   # #     #   # #     # ##",
        "##### ### ##### ##### ### ### ### ########### ### ### ##### ### ### ##",
        "#     #       #     # #         #   #     #       #   #   #     # ####",
        "### ##### ##### ### ### ### ##### ### ### ##### ##### ### ### ##### ##",
        "#       # #   #   # #       #   #     #     #       #     #       # ##",
        "### ### ### ##### ##### ### ### ### ### ##### ### ### ### ##### ### ##",
        "#     #     #   #       #     # #   # # #   # # #   # # #   #   #   ##",
        "##### ### ### ### ### ##### ##### ### ### ### ### ##### ### ##### ####",
        "#   #   #   #     # #   #     #     #     #       #     #       #   ##",
        "### ##### ### ##### ### ##### ### ### ######### ### ##### ### ### ####",
        "#   #     #   # #   # #       #     # #         #     #     # #     ##",
        "# ### ##### ### ### ### ##### ### # ### ### ##### ### ### ### ##### ##",
        "# #K  # #       #   #     # #     #     # # #     # # # # #   #   # ##",
        "# ##### ##### ### ### ### ### ### ##### ### ### ### ### ### ##### ####",
        "##   #   #     #     #   #     #   #     #     # # #         #      ##",
        "# ### ### ##### ### ### ### ##### ##### ### ### ### ### ##### ### ####",
        "# #       # #     #     #     #       #     #     # #     #     #   ##",
        "### ### ##### ##### ##### ### ### ######### ### ### ### ##### ### ####",
        "#   # #   # #   # #       #K  #       #   #     # # # #       # #   ##",
        "##### ### ### ### ### ######### ### ### ### ### ### ### ######### ####",
        "#   #   # #     #   #       #     #   #     #                       K#",
        "######################################################################"
    };
     char labirinto5[ALTURA][LARGURA] = {
        "######################################################################",
        "#                                                                  K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                E##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ###################################",
        "##K                                                                K##",
        "#################################  ####################################",
        "##K                                                                  K#",
        "######################################################################"
    };


    
    struct timeval start_time, end_time;
    double elapsed;
    Posicao jogador;
    char entrada;    
    char opcao;
    int em_jogo = 1;
    int jogando = 0;
    

    while (em_jogo) {
        imprimirMenu(menu);
        char opcao = getch();

        switch (opcao) {
            case '1':
                imprimirInicio(inicio);
                fgets(jogador.nick,50,stdin);
                jogador.x = 1;
                jogador.y = 1;
                jogando = 1;
                start_timer(&start_time);
                break;
            case '2':
                imprimirInstrucoes(instrucoes);
                break;
            case '3':
                em_jogo = 0;
                imprimirSaida(saida);
                break;
        }

        while (jogando==1) {
            imprimirLabirinto(labirinto1, jogador);
            entrada = getch(); // Captura a entrada do teclado

            switch (entrada) {
                case 'w': // Move para cima
                    if (jogador.y > 0 && labirinto1[jogador.y - 1][jogador.x] != '#') {
                        jogador.y--;
                    }
                    break;
                case 's': // Move para baixo
                    if (jogador.y < ALTURA - 1 && labirinto1[jogador.y + 1][jogador.x] != '#') {
                        jogador.y++;
                    }
                    break;
                case 'a': // Move para esquerda
                    if (jogador.x > 0 && labirinto1[jogador.y][jogador.x - 1] != '#') {
                        jogador.x--;
                    }
                    break;
                case 'd': // Move para direita
                    if (jogador.x < LARGURA - 1 && labirinto1[jogador.y][jogador.x + 1] != '#') {
                        jogador.x++;
                    }
                    break;
            }

            // Verifica se o jogador chegou à saída
            if (labirinto1[jogador.y][jogador.x] == 'E') {
                jogando ++;
                imprimirAvanco(Avancar1);
                 sleep(2);
                 jogador.x = 1;
                 jogador.y = 1;
                 while (jogando==2) {
                    imprimirLabirinto(labirinto2, jogador);
                    entrada = getch(); // Captura a entrada do teclado

                    switch (entrada) {
                        case 'w': // Move para cima
                            if (jogador.y > 0 && labirinto2[jogador.y - 1][jogador.x] != '#') {
                                jogador.y--;
                            }
                            break;
                        case 's': // Move para baixo
                            if (jogador.y < ALTURA - 1 && labirinto2[jogador.y + 1][jogador.x] != '#') {
                                jogador.y++;
                            }
                            break;
                        case 'a': // Move para esquerda
                            if (jogador.x > 0 && labirinto2[jogador.y][jogador.x - 1] != '#') {
                                jogador.x--;
                            }
                            break;
                        case 'd': // Move para direita
                            if (jogador.x < LARGURA - 1 && labirinto2[jogador.y][jogador.x + 1] != '#') {
                                jogador.x++;
                            }
                            break;
                    }

                    // Verifica se o jogador chegou à saída
                    if (labirinto2[jogador.y][jogador.x] == 'E') {
                        jogando ++;
                        imprimirAvanco(Avancar2);
                        sleep(2);
                        jogador.x = 1;
                        jogador.y = 1;
                        while (jogando==3) {
                            imprimirLabirinto(labirinto3, jogador);
                            entrada = getch(); // Captura a entrada do teclado

                            switch (entrada) {
                                case 'w': // Move para cima
                                    if (jogador.y > 0 && labirinto3[jogador.y - 1][jogador.x] != '#') {
                                        jogador.y--;
                                    }
                                    break;
                                case 's': // Move para baixo
                                    if (jogador.y < ALTURA - 1 && labirinto3[jogador.y + 1][jogador.x] != '#') {
                                        jogador.y++;
                                    }
                                    break;
                                case 'a': // Move para esquerda
                                    if (jogador.x > 0 && labirinto3[jogador.y][jogador.x - 1] != '#') {
                                        jogador.x--;
                                    }
                                    break;
                                case 'd': // Move para direita
                                    if (jogador.x < LARGURA - 1 && labirinto3[jogador.y][jogador.x + 1] != '#') {
                                        jogador.x++;
                                    }
                                    break;
                            }

                            // Verifica se o jogador chegou à saída
                            if (labirinto3[jogador.y][jogador.x] == 'E') {
                                jogando ++;
                                imprimirAvanco(Avancar3);
                                sleep(2);
                                jogador.x = 1;
                                jogador.y = 1;
                                while (jogando==4) {
                                    imprimirLabirinto(labirinto4, jogador);
                                    entrada = getch(); // Captura a entrada do teclado

                                    switch (entrada) {
                                        case 'w': // Move para cima
                                            if (jogador.y > 0 && labirinto4[jogador.y - 1][jogador.x] != '#') {
                                                jogador.y--;
                                            }
                                            break;
                                        case 's': // Move para baixo
                                            if (jogador.y < ALTURA - 1 && labirinto4[jogador.y + 1][jogador.x] != '#') {
                                                jogador.y++;
                                            }
                                            break;
                                        case 'a': // Move para esquerda
                                            if (jogador.x > 0 && labirinto4[jogador.y][jogador.x - 1] != '#') {
                                                jogador.x--;
                                            }
                                            break;
                                        case 'd': // Move para direita
                                            if (jogador.x < LARGURA - 1 && labirinto4[jogador.y][jogador.x + 1] != '#') {
                                                jogador.x++;
                                            }
                                            break;
                                    }
                                    if(labirinto4[jogador.y][jogador.x] == 'E') {
                                        jogando++;
                                        imprimirAvanco(Avancar4);
                                        sleep(2);
                                        jogador.x = 1;
                                        jogador.y = 1;
                                        while(jogando==5){  
                                            imprimirLabirinto(labirinto5, jogador);
                                            entrada = getch(); // Captura a entrada do teclado

                                            switch (entrada) {
                                            case 'w': // Move para cima
                                            if (jogador.y > 0 && labirinto5[jogador.y - 1][jogador.x] != '#') {
                                                jogador.y--;
                                            }
                                            break;
                                            case 's': // Move para baixo
                                            if (jogador.y < ALTURA - 1 && labirinto5[jogador.y + 1][jogador.x] != '#') {
                                                jogador.y++;
                                            }
                                            break;
                                            case 'a': // Move para esquerda
                                            if (jogador.x > 0 && labirinto5[jogador.y][jogador.x - 1] != '#') {
                                                jogador.x--;
                                            }
                                            break;
                                            case 'd': // Move para direita
                                            if (jogador.x < LARGURA - 1 && labirinto5[jogador.y][jogador.x + 1] != '#') {
                                                jogador.x++;
                                            }
                                            break;
                                    }
                                    if(labirinto5[jogador.y][jogador.x] == 'k'){
                                        jogador.x = 1;
                                        jogador.y = 1;
                                    }
                                        
                                    

                                    // Verifica se o jogador chegou à saída
                                    if (labirinto5[jogador.y][jogador.x] == 'E') {
                                        jogando = 0;
                                        jogador.x = 1;
                                        jogador.y = 1;
                                        stop_timer(&end_time);
                                        system("clear");
                                        elapsed = elapsed_time(start_time, end_time);
                                        imprimirFinal(final, elapsed, jogador);
                                        sleep(6);
                                        
                                    }}
                                }
                            }
                }
            }

                
        }
    }
    }}}


       

    return 0;
}